<!-- AI disclosure 
  Some Part of this code were generated by Chat GPT -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Employer · Loading…</title>
  <link rel="stylesheet" href="../assets/css/base.css">
  <style>
    html,body{height:100%}
    body{min-height:100vh;display:flex;flex-direction:column}
    main{flex:1}

    /* ===== Topbar (match candidate pages) ===== */
    .topbar{
      width:100%;
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:16px 24px;
      border-bottom:1px solid var(--line)
    }
    .brand{font-weight:700;text-decoration:none;color:var(--ink)}
    .brand:hover{text-decoration:underline}
    .logout{color:var(--ink);text-decoration:none;border:1px solid var(--line);padding:6px 10px;border-radius:10px}
    .logout:hover{background:#fff}

    /* ===== Back strip (match candidate pages) ===== */
    .back-strip{
      width:100%;
      padding:16px 24px 0;
      display:flex; justify-content:flex-start;
    }
    .backbtn{
      display:inline-flex;align-items:center;gap:8px;
      background:#fff;color:var(--ink);
      border:1px solid var(--line);
      border-radius:10px;
      padding:.45rem .8rem; cursor:pointer;
      text-decoration:none;
    }
    .backbtn:hover{background:#f6f8fc;border-color:#c8d2e6}
    .backbtn svg{width:18px;height:18px;stroke:currentColor}

    /* ===== Page header ===== */
    .page-header{max-width:1100px;margin:0 auto;padding:12px 24px 24px}
    .page-header h1{margin:0;text-align:center}
    .meta.center{text-align:center;color:var(--muted)}

    /* ===== Page content ===== */
    .wrap{max-width:1100px;margin:0 auto;padding:24px}
    .toolbar{display:flex;gap:12px;align-items:center;justify-content:space-between;margin-bottom:16px;flex-wrap:wrap}
    .search{flex:1;min-width:260px}

    /* Buttons */
    .btn.sm{padding:.45rem .75rem;font-size:.9rem;border-radius:8px}
    .btn.outline{background:#fff;border:1px solid #d7deea;color:#2f3b54}
    .btn.outline:hover{background:#f6f8fc;border-color:#c8d2e6}
    .btn.safe{background:var(--accent);color:#fff;border:0}
    .btn.safe:hover{filter:brightness(.96)}
    .actions-bar{display:flex;gap:10px;justify-content:flex-end;flex-wrap:wrap}

    /* Table sizing */
    .apps-table{table-layout:fixed}
    .apps-table th:nth-child(1), .apps-table td:nth-child(1){width:26%}
    .apps-table th:nth-child(2), .apps-table td:nth-child(2){width:16%}
    .apps-table th:nth-child(3), .apps-table td:nth-child(3){width:10%}
    .apps-table th:nth-child(4), .apps-table td:nth-child(4){width:14%}
    .apps-table th:nth-child(5), .apps-table td:nth-child(5){width:12%}
    .apps-table th:nth-child(6), .apps-table td:nth-child(6){width:22%}
    .apps-table td:nth-child(5){overflow:visible;white-space:nowrap}
    .tagline{color:var(--muted);font-size:.95rem}

    /* -------- Pill-style dropdown -------- */
    .pill-dd{position:relative;display:inline-block}
    .pill-select{
      -webkit-appearance:none;appearance:none;
      padding:.56rem 2.6rem .56rem 1.1rem;
      border-radius:999px;border:1px solid #cfd7e6;
      background:#fff;color:#52607a;line-height:1.0;
      font-size:.75rem;cursor:pointer;
      min-width:clamp(7.0rem,9ch,10rem)
    }
    .pill-dd::after{
      content:"";position:absolute;right:.8rem;top:50%;transform:translateY(-50%);
      width:12px;height:12px;pointer-events:none;
      background:
        linear-gradient(45deg,transparent 50%,#52607a 50%) bottom left/50% 50% no-repeat,
        linear-gradient(-45deg,transparent 50%,#52607a 50%) bottom right/50% 50% no-repeat;
    }

    .pill-select[data-status="review"]{background:#fff;color:#52607a;border-color:#cfd7e6}
    .pill-select[data-status="interview"]{background:#eef8ff;color:#0b63c9;border-color:#b8d8ff}
    .pill-select[data-status="rejected"]{background:#fff5f5;color:#b42318;border-color:#f2c2c2}
    .pill-select[data-status="approved"]{background:#f4fbf7;color:#18794e;border-color:#b9e4ce}

    /* No results row */
    .no-results{text-align:center;color:var(--muted)}

    /* ---------- Modal system ---------- */
    .backdrop{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(17,24,39,.45);z-index:300}
    .backdrop.show{display:flex}
    .modal{width:min(620px,94vw);background:#fff;border:1px solid var(--line);border-radius:14px;box-shadow:0 24px 60px rgba(2,8,23,.28)}
    .modal header{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;border-bottom:1px solid var(--line)}
    .modal .body{padding:16px}
    .modal .footer{padding:14px 16px;border-top:1px solid var(--line);display:flex;gap:10px;justify-content:flex-end;flex-wrap:wrap}
    .modal .close-x{background:transparent;border:0;font-size:1.4rem;color:var(--muted);cursor:pointer;line-height:1}
    .muted{color:var(--muted)}
    .kvs{display:grid;grid-template-columns:140px 1fr;gap:8px 14px}
    .list{margin:0;padding-left:18px}
    .input.textarea{min-height:120px}
    .ok{background:#16a34a;border:1px solid #16a34a;color:#fff}
    .ok:hover{filter:brightness(.95)}
    .danger{background:#dc2626;border:1px solid #dc2626;color:#fff}
    .danger:hover{filter:brightness(.95)}
  </style>
</head>
<body>
  <!-- Top bar -->
  <div class="topbar">
    <a class="brand" href="../index.html">Student2Success</a>
    <a href="../index.html" class="logout">Logout</a>
  </div>

  <!-- Back button (dynamic like other pages) -->
  <div class="back-strip">
    <button id="backBtn" class="backbtn" type="button">
      <svg viewBox="0 0 24 24" fill="none"><path d="M15 6l-6 6 6 6" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/></svg>
      <span id="backLabel">Jobs</span>
    </button>
  </div>

  <!-- Centered header -->
  <header class="page-header">
    <h1>Applicants</h1>
    <div id="jobTag" class="tagline meta center" aria-live="polite">Loading…</div>
  </header>

  <main>
    <div class="wrap">
      <div class="toolbar">
        <input id="search" class="input search" placeholder="Search applicants by name, email, or keyword" aria-label="Search applicants">
        <div class="actions-bar">
          <select id="statusFilter" class="input" style="width:180px" aria-label="Filter by status">
            <option value="">Filter by status</option>
            <option>Under Review</option>
            <option>Interview</option>
            <option>Approved</option>
            <option>Rejected</option>
          </select>
          <button id="saveChanges" class="btn safe">Save changes</button>
        </div>
      </div>

      <div class="card">
        <table class="table apps-table">
          <thead>
            <tr>
              <th>Applicant</th>
              <th>Degree</th>
              <th class="num">GPA</th>
              <th>Submitted</th>
              <th>Status</th>
              <th class="actions">Actions</th>
            </tr>
          </thead>
          <tbody id="appsBody">
            <tr>
              <td>Alex Johnson<br><span class="meta">alex.johnson@uni.edu</span></td>
              <td>BSc Computer Science</td>
              <td class="num">3.7</td>
              <td>2025-10-05</td>
              <td>
                <span class="pill-dd">
                  <select class="pill-select" aria-label="Status for Alex Johnson">
                    <option selected>Under Review</option>
                    <option>Interview</option>
                    <option>Approved</option>
                    <option>Rejected</option>
                  </select>
                </span>
              </td>
              <td class="actions">
                <div class="actions-bar">
                  <button class="btn sm outline" data-action="view">View</button>
                  <button class="btn sm outline" data-action="message">Message</button>
                  <button class="btn sm safe" data-action="download">Download Resume</button>
                </div>
              </td>
            </tr>

            <tr>
              <td>Maya Patel<br><span class="meta">maya.patel@uni.edu</span></td>
              <td>BSc Software Engineering</td>
              <td class="num">3.9</td>
              <td>2025-10-04</td>
              <td>
                <span class="pill-dd">
                  <select class="pill-select" aria-label="Status for Maya Patel">
                    <option>Under Review</option>
                    <option selected>Interview</option>
                    <option>Approved</option>
                    <option>Rejected</option>
                  </select>
                </span>
              </td>
              <td class="actions">
                <div class="actions-bar">
                  <button class="btn sm outline" data-action="view">View</button>
                  <button class="btn sm outline" data-action="message">Message</button>
                  <button class="btn sm safe" data-action="download">Download Resume</button>
                </div>
              </td>
            </tr>

            <tr>
              <td>Ethan Park<br><span class="meta">e.park@uni.edu</span></td>
              <td>BSc Data Science</td>
              <td class="num">3.5</td>
              <td>2025-10-02</td>
              <td>
                <span class="pill-dd">
                  <select class="pill-select" aria-label="Status for Ethan Park">
                    <option>Under Review</option>
                    <option>Interview</option>
                    <option>Approved</option>
                    <option selected>Rejected</option>
                  </select>
                </span>
              </td>
              <td class="actions">
                <div class="actions-bar">
                  <button class="btn sm outline" data-action="view">View</button>
                  <button class="btn sm outline" data-action="message">Message</button>
                  <button class="btn sm safe" data-action="download">Download Resume</button>
                </div>
              </td>
            </tr>
          </tbody>
          <tbody id="noResults" style="display:none">
            <tr>
              <td class="no-results" colspan="6">No applicants match your filters.</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </main>

  <footer class="footer">Student2Success</footer>

  <!-- Generic modal (reused for all pop-ups) -->
  <div id="modal" class="backdrop" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <div class="modal" role="document">
      <header>
        <h2 id="modalTitle">Title</h2>
        <button class="close-x" type="button" aria-label="Close">×</button>
      </header>
      <div class="body" id="modalBody"></div>
      <div class="footer" id="modalFooter"></div>
    </div>
  </div>

  <script>
    /* --- small dataset for fallback by ?id= --- */
    const JOBS = {
      'swe-intern':         { title: 'Software Developer Intern', company: 'Tech Corp',        location: 'Remote' },
      'web-engineer-coop':  { title: 'Web Engineer Co-op',        company: 'SiteWorks',        location: 'Remote' },
      'backend-fulltime':   { title: 'Backend Developer',         company: 'Nexus Analytics',  location: 'Toronto' },
      'support-parttime':   { title: 'IT Support Specialist',     company: 'CloudCore',        location: 'Vancouver' },
      'data-analyst-intern':{ title: 'Data Analyst Intern',       company: 'DataViz Inc',      location: 'Calgary' }
    };

    /* ---------- Dynamic header + back button ---------- */
    const params       = new URLSearchParams(location.search);
    const idParam      = params.get('id') || '';
    const explicitTitle= (params.get('title')   || '').trim();
    const explicitCo   = (params.get('company') || '').trim();
    const explicitLoc  = (params.get('location')|| '').trim();
    const fromParam    = params.get('from');

    const fallback = JOBS[idParam] || {};
    const jobTitle = explicitTitle || fallback.title || 'Job';
    const company  = explicitCo    || fallback.company || '';
    const place    = explicitLoc   || fallback.location || '';

    // Compose the small tagline under "Applicants"
    const tagParts = [jobTitle, company, place].filter(Boolean);
    const tagline  = tagParts.join(' · ') || jobTitle;

    document.title = `Employer · Applicants – ${company ? `${jobTitle} at ${company}` : jobTitle}`;
    const jobTagEl = document.getElementById('jobTag');
    jobTagEl.textContent = tagline;
    jobTagEl.setAttribute('aria-live', 'polite');

    // Back button behavior (use ?from or referrer)
    const backBtn   = document.getElementById('backBtn');
    const backLabel = document.getElementById('backLabel');
    const ref       = document.referrer || '';

    function resolveBack(){
      if (fromParam === 'dashboard' || /\/employer-dashboard\.html/i.test(ref)){
        return { href: 'employer-dashboard.html', label: 'Dashboard' };
      }
      if (fromParam === 'jobs' || /\/jobs\.html/i.test(ref)){
        return { href: 'jobs.html', label: 'Jobs' };
      }
      return { href: 'jobs.html', label: 'Jobs' };
    }
    const back = resolveBack();
    backLabel.textContent = back.label;
    backBtn.onclick = () => { window.location.href = back.href; };

    /* ---------- Status pill appearance ---------- */
    const STATUS_TOKEN = {
      "Under Review": "review",
      "Interview": "interview",
      "Rejected": "rejected",
      "Approved": "approved"
    };
    function applyStatusAppearance(sel){ sel.dataset.status = STATUS_TOKEN[sel.value] || "review"; }
    document.querySelectorAll('.pill-select').forEach(sel=>{
      applyStatusAppearance(sel);
      sel.addEventListener('change', ()=>{ applyStatusAppearance(sel); applyFilters(); markDirty(sel); });
    });

    /* ---------- Search + filter ---------- */
    const searchInput    = document.getElementById('search');
    const statusFilter   = document.getElementById('statusFilter');
    const bodyRows       = Array.from(document.querySelectorAll('#appsBody tr'));
    const noResultsTbody = document.getElementById('noResults');

    // Cache initial data
    const rowData = bodyRows.map(tr => {
      const nameEmail = tr.cells[0]?.innerText || "";
      const degree    = tr.cells[1]?.innerText || "";
      const statusSel = tr.querySelector('.pill-select');
      return {
        tr,
        name: tr.cells[0].childNodes[0].textContent.trim(),
        email: tr.cells[0].querySelector('.meta')?.textContent.trim() || "",
        degree: degree.trim(),
        gpa: tr.cells[2]?.innerText.trim() || "",
        date: tr.cells[3]?.innerText.trim() || "",
        statusSel,
        initialStatus: statusSel.value,
        searchText: (nameEmail + " " + degree).toLowerCase()
      };
    });

    function applyFilters(){
      const q = searchInput.value.trim().toLowerCase();
      const statusWanted = statusFilter.value;
      let visible = 0;
      rowData.forEach(r=>{
        const matchSearch = !q || r.searchText.includes(q);
        const matchStatus = !statusWanted || r.statusSel.value === statusWanted;
        const show = matchSearch && matchStatus;
        r.tr.style.display = show ? "" : "none";
        if (show) visible++;
      });
      noResultsTbody.style.display = visible === 0 ? "" : "none";
    }
    searchInput.addEventListener('input', applyFilters);
    statusFilter.addEventListener('change', applyFilters);
    applyFilters();

    /* ---------- Modal helpers ---------- */
    const modal = document.getElementById('modal');
    const modalTitle = document.getElementById('modalTitle');
    const modalBody  = document.getElementById('modalBody');
    const modalFooter= document.getElementById('modalFooter');
    let lastFocusEl = null;

    function openModal({title, body, actions=[]}){
      lastFocusEl = document.activeElement;
      modalTitle.textContent = title || "Notice";
      modalBody.innerHTML = body || "";
      modalFooter.innerHTML = "";
      actions.forEach(a=>{
        const btn = document.createElement('button');
        btn.type = "button";
        btn.className = `btn ${a.variant || ''}`.trim();
        btn.textContent = a.label || "OK";
        btn.addEventListener('click', ()=> a.onClick && a.onClick());
        modalFooter.appendChild(btn);
      });
      modal.classList.add('show');
      const first = modal.querySelector('button, [href], input, select, textarea');
      if (first) first.focus();
    }
    function closeModal(){ modal.classList.remove('show'); lastFocusEl && lastFocusEl.focus(); }
    modal.addEventListener('click', e=>{ if (e.target === modal) closeModal(); });
    modal.querySelector('.close-x').addEventListener('click', closeModal);
    window.addEventListener('keydown', e=>{ if (e.key === 'Escape' && modal.classList.contains('show')) closeModal(); });

    /* ---------- Change tracking + Save pop-up ---------- */
    function getChanges(){
      return rowData
        .filter(r => r.initialStatus !== r.statusSel.value)
        .map(r => ({ name:r.name, from:r.initialStatus, to:r.statusSel.value }));
    }
    function markDirty(_sel){ /* hook for future */ }

    document.getElementById('saveChanges').addEventListener('click', ()=>{
      const changes = getChanges();
      if (changes.length === 0){
        openModal({
          title: "Nothing to save",
          body: "<p class='muted'>No status changes detected.</p>",
          actions: [{label:"OK", variant:"ok", onClick: closeModal}]
        });
        return;
      }
      const list = changes.map(c => `<li><strong>${c.name}</strong>: ${c.from} → <strong>${c.to}</strong></li>`).join("");
      openModal({
        title: "Confirm save",
        body: `<p>You’re about to save <strong>${changes.length}</strong> change(s):</p>
               <ul class="list">${list}</ul>`,
        actions: [
          {label:"Cancel", variant:"outline", onClick: closeModal},
          {label:"Save", variant:"ok", onClick: ()=>{
            changes.forEach(c=>{
              const row = rowData.find(r => r.name === c.name);
              if (row) row.initialStatus = row.statusSel.value;
            });
            openModal({
              title: "Changes saved",
              body: "<p>Your updates were saved successfully.</p>",
              actions: [{label:"Done", variant:"ok", onClick: closeModal}]
            });
          }}
        ]
      });
    });

    /* ---------- Row actions: View / Message / Download ---------- */
    document.getElementById('appsBody').addEventListener('click', (e)=>{
      const btn = e.target.closest('button[data-action]');
      if (!btn) return;
      const tr = btn.closest('tr');
      const r  = rowData.find(x => x.tr === tr);
      if (!r) return;

      const action = btn.dataset.action;
      if (action === 'view'){
        openModal({
          title: `Applicant · ${r.name}`,
          body: `
            <div class="kvs">
              <div class="muted">Email</div>     <div>${r.email}</div>
              <div class="muted">Degree</div>    <div>${r.degree}</div>
              <div class="muted">GPA</div>       <div>${r.gpa}</div>
              <div class="muted">Submitted</div> <div>${r.date}</div>
              <div class="muted">Status</div>    <div>${r.statusSel.value}</div>
            </div>
          `,
          actions: [{label:"Close", variant:"outline", onClick: closeModal}]
        });
      }
      else if (action === 'message'){
        openModal({
          title: `Message · ${r.name}`,
          body: `
            <label class="label" for="msgBox">Your message</label>
            <textarea id="msgBox" class="input textarea" placeholder="Write a quick note..."></textarea>
          `,
          actions: [
            {label:"Cancel", variant:"outline", onClick: closeModal},
            {label:"Send", variant:"ok", onClick: ()=>{
              const msg = (document.getElementById('msgBox')?.value || "").trim();
              openModal({
                title:"Message sent",
                body:`<p>Your message to <strong>${r.name}</strong> has been queued.</p>
                      <p class='muted'>Preview:</p>
                      <div class='card' style="padding:10px">${msg ? msg.replace(/</g,"&lt;") : "(no content)"}</div>`,
                actions:[{label:"Done", variant:"ok", onClick: closeModal}]
              });
            }}
          ]
        });
        document.getElementById('msgBox')?.focus();
      }
      else if (action === 'download'){
        openModal({
          title: `Download resume`,
          body: `<p>Download resume for <strong>${r.name}</strong>?</p>
                 <p class="muted">This prototype generates a simple placeholder file.</p>`,
          actions: [
            {label:"Cancel", variant:"outline", onClick: closeModal},
            {label:"Download", variant:"ok", onClick: ()=>{
              const content =
                `Resume\n=======\nName: ${r.name}\nEmail: ${r.email}\nDegree: ${r.degree}\nGPA: ${r.gpa}\nSubmitted: ${r.date}\nStatus: ${r.statusSel.value}\n`;
              const blob = new Blob([content], {type:"text/plain"});
              const url  = URL.createObjectURL(blob);
              const a = document.createElement('a');
              a.href = url;
              a.download = `Resume_${r.name.replace(/\s+/g,'_')}.txt`;
              document.body.appendChild(a);
              a.click();
              a.remove();
              setTimeout(()=>URL.revokeObjectURL(url), 1000);

              openModal({
                title:"Download started",
                body:`<p>The resume for <strong>${r.name}</strong> is being downloaded.</p>`,
                actions:[{label:"Close", variant:"ok", onClick: closeModal}]
              });
            }}
          ]
        });
      }
    });
  </script>
</body>
</html>